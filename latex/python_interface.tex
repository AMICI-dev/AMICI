In the following we will give a detailed overview how to specify models in Python and how to call the generated simulation files.\hypertarget{python_interface_autotoc_md42}{}\doxysubsection{Model Definition}\label{python_interface_autotoc_md42}
This guide will guide the user on how to specify models to import and simulate them using the Python interface. For example implementations see the examples in the {\ttfamily python/examples} directory.\hypertarget{python_interface_autotoc_md43}{}\doxysubsubsection{S\+B\+M\+L import}\label{python_interface_autotoc_md43}
\href{http://sbml.org/}{\texttt{ S\+B\+ML}} is a commonly used format for specifying systems biology models. To import an S\+B\+ML model into A\+M\+I\+CI, first, load an S\+B\+ML file using the {\ttfamily amici.\+sbml\+\_\+import.\+Sbml\+Importer} class\+: \begin{DoxyVerb}import amici
sbml_importer = amici.SbmlImporter('model_steadystate_scaled.sbml')
\end{DoxyVerb}


the S\+B\+ML model as imported by \href{http://sbml.org/Software/libSBML}{\texttt{ lib\+S\+B\+ML}} is available as \begin{DoxyVerb}sbml_model = sbml_importer.sbml
\end{DoxyVerb}
\hypertarget{python_interface_autotoc_md44}{}\doxyparagraph{Constants}\label{python_interface_autotoc_md44}
Model parameters that should be considered constants can be specified in a list of strings specifying the S\+B\+ML ID of the respective parameter, e.\+g.\+: \begin{DoxyVerb}constant_parameters=['k4']
\end{DoxyVerb}
\hypertarget{python_interface_autotoc_md45}{}\doxyparagraph{Observables}\label{python_interface_autotoc_md45}
Observables are specified as a dictionary with observable ID as key and observable formula as value.

A convenient way for specifying observables for an S\+B\+ML model is storing them as {\ttfamily Assignment\+Rule}s. Assignment rules that should be considered as observables can then be extracted using the {\ttfamily amici.\+assignment\+Rules2observables} function, e.\+g.\+: \begin{DoxyVerb}observables = amici.assignmentRules2observables(sbml, filter_function=lambda variable: 
                                                variable.getId().startswith('observable_') and not variable.getId().endswith('_sigma'))
\end{DoxyVerb}
\hypertarget{python_interface_autotoc_md46}{}\doxyparagraph{Standard Deviations}\label{python_interface_autotoc_md46}
Standard deviations can be specified as dictionaries ... \begin{DoxyVerb}sigmas = {'observable_x1withsigma': 'observable_x1withsigma_sigma'}
\end{DoxyVerb}
\hypertarget{python_interface_autotoc_md47}{}\doxyparagraph{Model Compilation}\label{python_interface_autotoc_md47}
To generate a Python module from the S\+B\+ML model, call the method {\ttfamily amici.\+sbml\+\_\+import.\+Sbml\+Importer.\+sbml2amici}, passing all the previously defined model specifications\+: \begin{DoxyVerb}sbml_importer.sbml2amici('test', 'test',
                         observables=observables,
                         constant_parameters=constant_parameters,
                         sigmas=sigmas)
\end{DoxyVerb}
\hypertarget{python_interface_autotoc_md48}{}\doxysubsubsection{Py\+S\+B import}\label{python_interface_autotoc_md48}
\href{http://pysb.org/}{\texttt{ Py\+SB}} is a tool for specifying rule-\/based systems biology models as Python code. A\+M\+I\+CI can import Py\+SB models via \href{https://amici.readthedocs.io/en/latest/generated/amici.pysb_import.html\#amici.pysb_import.pysb2amici}{\texttt{ {\ttfamily amici.\+pysb\+\_\+import.\+pysb2amici}}}.

\href{https://www.csb.pitt.edu/Faculty/Faeder/?page_id=409}{\texttt{ Bio\+Net\+Gen}} and \href{https://kappalanguage.org/}{\texttt{ Kappa}} models can be imported into A\+M\+I\+CI using Py\+SB.\hypertarget{python_interface_autotoc_md49}{}\doxysubsubsection{P\+Etab import}\label{python_interface_autotoc_md49}
\href{https://github.com/PEtab-dev/PEtab}{\texttt{ P\+Etab}} is a format for specifying parameter estimation problems. It is based on an S\+B\+ML model and tab-\/separated value files specifying the observation mdoel and experimental conditions.

A\+M\+I\+CI can import P\+Etab-\/based model definitions and run simulations for the specified simulations conditions. For usage, see \href{https://github.com/AMICI-dev/AMICI/blob/develop/python/examples/example_petab/petab.ipynb}{\texttt{ python/examples/example\+\_\+petab/petab.\+ipynb}}.\hypertarget{python_interface_autotoc_md50}{}\doxysubsubsection{Importing plain O\+D\+Es}\label{python_interface_autotoc_md50}
The A\+M\+I\+CI Python interface does not currently support direct import of O\+D\+Es. However, it is straightforward to encode them as Rate\+Rules in an S\+B\+ML model. The \href{https://github.com/martamatos/yaml2sbml}{\texttt{ yaml2sbml}} package may come in handy, as it facilitates generating S\+B\+ML models from a Y\+A\+M\+L-\/based specification of an O\+DE model. Besides the S\+B\+ML model it can also create \href{https://github.com/PEtab-dev/PEtab}{\texttt{ P\+Etab}} files.\hypertarget{python_interface_autotoc_md51}{}\doxysubsection{Model Simulation}\label{python_interface_autotoc_md51}
A\+M\+I\+CI model import creates a Python module for simulation of the respective model. To use the model module, the model directory has to be manually added to the python path\+: \begin{DoxyVerb}import sys
sys.path.insert(0, 'test')
\end{DoxyVerb}


the compiled model can then be imported as \begin{DoxyVerb}import test as model_module
\end{DoxyVerb}


It is usually more convenient to use {\ttfamily amici.\+import\+\_\+model\+\_\+module()} for that purpose.

To obtain a model instance call the {\ttfamily get\+Model()} method. This model instance will be instantiated using the default parameter values specified in the imported model\+: \begin{DoxyVerb}model = model_module.getModel()
\end{DoxyVerb}


Specify the simulation timepoints via {\ttfamily \mbox{\hyperlink{classamici_1_1_model_a50f9642f9bcb883dbd3925c85abc4c24}{amici.\+Model.\+set\+Timepoints}}}\+: \begin{DoxyVerb}model.setTimepoints(np.linspace(0, 60, 60)) 
\end{DoxyVerb}


For simulation, we need to generate a solver instance\+: \begin{DoxyVerb}solver = model.getSolver()
\end{DoxyVerb}


The model simulation can now be carried out using {\ttfamily amici.\+run\+Amici\+Simulation}\+: \begin{DoxyVerb}rdata = amici.runAmiciSimulation(model, solver)
\end{DoxyVerb}
\hypertarget{python_interface_autotoc_md52}{}\doxysubsection{Building models with Open\+M\+P support}\label{python_interface_autotoc_md52}
A\+M\+I\+CI can be built with Open\+MP support, which allows to parallelize model simulations for multiple experimental conditions.

On Linux and O\+SX this is enabled by default. This can be verified using \begin{DoxyVerb}import amici
amici.compiledWithOpenMP()
\end{DoxyVerb}


If not already enabled by default, you can enable Open\+MP support by setting the environment variables {\ttfamily A\+M\+I\+C\+I\+\_\+\+C\+X\+X\+F\+L\+A\+GS} and {\ttfamily A\+M\+I\+C\+I\+\_\+\+L\+D\+F\+L\+A\+GS} to the correct Open\+MP flags of your compiler and linker, respectively. This has to be done for both A\+M\+I\+CI package installation {\itshape and} model compilation. When using {\ttfamily gcc} on Linux, this would be\+: \begin{DoxyVerb}# on your shell:
AMICI_CXXFLAGS=-fopenmp AMICI_LDFLAGS=-fopenmp pip3 install amici

# in python, before model compilation:
import os
os.environ['AMICI_CXXFLAGS'] = '-fopenmp'
os.environ['AMICI_LDFLAGS'] = '-fopenmp'
\end{DoxyVerb}
 