In the following we will briefly outline what happens when a model is compiled. For a more detailed description we refer the reader to the documentation of the individual functions.

After specifying a model (see \hyperlink{def_simu_definition}{Model Definition}) the user will typically compile the model by invoking \hyperlink{amiwrap_8m_a183dd11adc4bd525147faa2590ea325b}{amiwrap()}. \hyperlink{amiwrap_8m_a183dd11adc4bd525147faa2590ea325b}{amiwrap()} first instantiates an object of the class \hyperlink{classamimodel}{amimodel}. The properties of this object are initialised based on the user-\/defined model. If the o2flag is active, all subsequent computations will also be carried out on the augmented system, which also includes the equations for forward sensitivities. This allows the computation of second order sensitivities in a forward-\/forward approach. A forward-\/adjoint approach will be implemented in the future.

The fun fields of this object will then be populated by \hyperlink{classamimodel_a68efdc6ed5d618672bea1556209e5568}{amimodel\+::parse\+Model()}. The \hyperlink{classamimodel_a743fa290dbc0a67a3843d5ab0426e9b4}{amimodel\+::fun} field contains all function definitions of type \hyperlink{classamifun}{amifun} which are required for model compilation. The set of functions to be considered will depend on the user specification of the model fields \hyperlink{classamimodel_ab6d500b41cf50693452415caca31d32e}{amimodel\+::adjoint} and \hyperlink{classamimodel_a81e42e48c9c72814166c8f7cd414ce24}{amimodel\+::forward} (see \hyperlink{def_simu_options}{Options}) as well as the employed solver (C\+V\+O\+D\+E\+S or I\+D\+A\+S, see \hyperlink{def_simu_rhs}{Differential Equation}). For all considered functions \hyperlink{classamimodel_a68efdc6ed5d618672bea1556209e5568}{amimodel\+::parse\+Model()} will check their dependencies via \hyperlink{classamimodel_aa04dcfc1d2188cae948a75ebd46a6e03}{amimodel\+::check\+Deps()}. These dependencies are a subset of the user-\/specified fields of \hyperlink{classamimodel_a743fa290dbc0a67a3843d5ab0426e9b4}{amimodel\+::fun} (see \hyperlink{def_simu_attach}{Attach to Model Struct}). \hyperlink{classamimodel_a68efdc6ed5d618672bea1556209e5568}{amimodel\+::parse\+Model()} compares the hashes of all dependencies against the \hyperlink{classamimodel_aafe6335df413dd688a2f44efba012cf1}{amimodel\+::\+H\+Table} of possible previous compilations and will only compute necessary symbolic expressions if changes in these fields occured.

For all functions for which \hyperlink{classamimodel_a743fa290dbc0a67a3843d5ab0426e9b4}{amimodel\+::fun} exists, \hyperlink{classamimodel_af2ce5001c2320c95471ecb8c3d73bdbb}{amimodel\+::generate\+C()} will generate C files. These files together with their respective header files will be placed in \$\+A\+M\+I\+C\+I\+D\+I\+R/models/{\itshape modelname}. \hyperlink{classamimodel_af2ce5001c2320c95471ecb8c3d73bdbb}{amimodel\+::generate\+C()} will also generate wrapfunctions.\+h and wrapfunctions.\+c. These files define and declare model unspecific wrapper functions around model specific functions. This construction allows us to use to build multiple different models against the same simulation routines by linking different realisations of these wrapper functions.

All the generated C functions are subsequently compiled by \hyperlink{classamimodel_ad1339463ebc3a2e6c6aeda6f63f1b4ed}{amimodel\+::compile\+C()}. For all functions individual object files are created to reduce the computation cost of code optimization. Moreover necessary code from sundials and Suite\+Sparse is compiled as object files and placed in /models/{\itshape mexext}, where mexext stands for the string returned by matlab to the command mexext. The mex simulation file is compiled from \hyperlink{amiwrap_8c}{amiwrap.\+c}, linked against all object necessary of sundials, Suite\+Sparse and model specific functions. Depending on the required solver, the compilation will either include \hyperlink{cvodewrap_8h_source}{cvodewrap.\+h} or \hyperlink{idawrap_8h_source}{idawrap.\+h}. These files implement solver specific realisations of the A\+M\+I... functions used in \hyperlink{amiwrap_8c}{amiwrap.\+c} and \hyperlink{amici_8c}{amici.\+c}. This allows the use of the same simulation routines for both C\+V\+O\+D\+E\+S and I\+D\+A\+S. 